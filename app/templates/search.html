{% extends "layout/base.html" %}

{% block head %}
<link href="{{ url_for('static', filename='css/slider.css') }}" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="row" style="margin-top:4%; height:95%">
<div class="col-md-4" style="padding:0px;padding-left:20px;height:100%">
    <div class = "row" style="height:60%">
        <div class="col-md-6" style="padding:0px;height:100%">
            <!-- Like field -->
            <div class="panel panel-primary panel-success"  style="margin:0px;height: 100%">
                <div class="panel-heading">
                    <h3 class="panel-title">Like these domains</h3>
                </div>
                <div class="panel-body">
                    <form role="form" action="/search" method="post" name="edit">
                    {{add_form.hidden_tag()}}
                        <div class="form-group">
                            {{add_form.add_pos_domain(size=50, class="form-control", autocomplete='off', value="", id="add_pos_domain", **{'data-provide':'typeahead'})}}
		            {{add_form.pos_domains(size=150, class="form-control", type='hidden', autocomplete='off', value = config)}}
                        </div>
                        <button type="submit" class="btn btn-default" value='submit'><span class="glyphicon glyphicon-plus"></span> Add</button>
                    </form>
              	</div>
	            {% if config['pos_domains'] %}
	            <div class="panel-body" style="height:inherit;overflow:auto">
		            {%for line in config['pos_domains'].split(", ") %}
		            {% set _dummy = config.update({'pos_delete':line}) %}
		            <form class="form" role="form" action="/search" method="post" name="pos">
		            {{add_form.del_pos_domain(size=10, class="form-control", type='hidden', autocomplete='off', value = config)}}		
		            <button type="submit" class="btn btn-success" value="submit" style="font-size: 15px; margin-top: 5px">{{line}}<span class="glyphicon glyphicon-remove" style="font-size: 1.3em; vertical-align:middle; margin-left: 10px"></span></button>
		            </form>
		            {% endfor %}
                    {% set _dummy = config.update({'pos_delete':''}) %}
	            </div>
	            {% endif %}
            </div>
        </div>
        <!-- Unlike field -->
        <div class="col-md-6" style="padding:0px;height:100%">
            <div class="panel panel-primary panel-danger"  style="margin:0px;height:100%">
                <div class="panel-heading">
                    <h3 class="panel-title">Unlike these domains</h3>
                </div>
                <div class="panel-body">
                    <form role="form" action="/search" method="post" name="edit">
                    {{add_form.hidden_tag()}}
                        <div class="form-group">
                            {{add_form.add_neg_domain(size=50, class="form-control", autocomplete='off', value="", id="add_neg_domain", **{'data-provide':'typeahead'})}}
		            {{add_form.neg_domains(size=150, class="form-control", type='hidden', autocomplete='off', value = config)}}
                        </div>
                        <button type="submit" class="btn btn-default" value='submit'><span class="glyphicon glyphicon-plus"></span> Add</button>
                    </form>
              	</div>
	            {% if config['neg_domains'] %}
	            <div class="panel-body" style="height:inherit;overflow:auto">
		            {%for line in config['neg_domains'].split(", ") %}
		            {% set _dummy = config.update({'neg_delete':line}) %}
		            <form class="form" role="form" action="/search" method="post" name="neg">
		            {{add_form.del_neg_domain(size=10, class="form-control", type='hidden', autocomplete='off', value = config )}}		
		            <button type="submit" class="btn btn-danger" value="submit" style="font-size: 15px; margin-top: 5px">{{line}}<span class="glyphicon glyphicon-remove" style="font-size: 1.3em; vertical-align:middle; margin-left: 10px"></span></button>
		            </form>
		            {% endfor %}
                    {% set _dummy = config.update({'pos_delete':''}) %}
	            </div>
	            {% endif %}
            </div>
        </div>
    </div>
    <div class = "row" style="height:35%">
        <div class="col-md-12" style="padding:0px;height:100%">
            <div class="panel panel-info"  style="margin:0px;height: 100%">
                <div class="panel-heading">
                    <h3 class="panel-title">Select effect of each metric on recommender</h3>
                </div>
                <div class="panel-body" style="height:100%">
                    <div class="row"  id ="sliders" style="visibility: hidden">
                      <form role="form" action="/search" method="post" name="slider">  
                        <div class="col-md-6">    
                    Edge weights:<br><div style="margin-bottom:0px">10%{{slider_form.links_slider(id ='links_slider', class='span2', size=15, value=config['links_slider'], ** {'data-slider-min':'10', 'data-slider-max':'100', 'data-slider-step':'10', 'data-slider-value':config['links_slider'], 'data-slider-orientation':'horizontal', 'data-slider-selection':'after', 'data-slider-tooltip':'hide'})}}100%</div><br>
                    Alexa rank:<br><div style="margin-bottom:0px">0%{{slider_form.alexa_slider(id ='alexa_slider', class='span2', size=15, value=config['alexa_slider'], ** {'data-slider-min':'0', 'data-slider-max':'100', 'data-slider-step':'10', 'data-slider-value':config['alexa_slider'], 'data-slider-orientation':'horizontal', 'data-slider-selection':'after', 'data-slider-tooltip':'hide'})}}100%</div><br>
                    Page rank:<br><div style="margin-bottom:0px">0%{{slider_form.p_rank_slider(id ='p_rank_slider', class='span2', size=15, value=config['p_rank_slider'], ** {'data-slider-min':'0', 'data-slider-max':'100', 'data-slider-step':'10', 'data-slider-value':config['p_rank_slider'], 'data-slider-orientation':'horizontal', 'data-slider-selection':'after', 'data-slider-tooltip':'hide'})}}100%</div><br>
                        {{slider_form.config(size=150, class="form-control", type='hidden', autocomplete='off', value = config)}}
                        <button type="submit" class="btn btn-default" value='submit'><span class="glyphicon glyphicon-repeat"></span> Recalculate</button>            
                        </div>
                        <div class="col-md-6">
                    In Degree:<br><div style="margin-bottom:0px">0%{{slider_form.in_slider(id ='in_slider', class='span2', size=15, value=config['in_slider'], ** {'data-slider-min':'0', 'data-slider-max':'100', 'data-slider-step':'10', 'data-slider-value':config['in_slider'], 'data-slider-orientation':'horizontal', 'data-slider-selection':'after', 'data-slider-tooltip':'hide'})}}100%</div><br>
                    Out Degree:<br><div style="margin-bottom:5px">0%{{slider_form.out_slider(id ='out_slider', class='span2', size=15, value=config['out_slider'], ** {'data-slider-min':'0', 'data-slider-max':'100', 'data-slider-step':'10', 'data-slider-value':config['out_slider'], 'data-slider-orientation':'horizontal', 'data-slider-selection':'after', 'data-slider-tooltip':'hide'})}}100%</div><br>
                    Self Degree:<br><div style="margin-bottom:5px">0%{{slider_form.self_slider(id ='self_slider', class='span2', size=15, value=config['self_slider'], ** {'data-slider-min':'0', 'data-slider-max':'100', 'data-slider-step':'10', 'data-slider-value':config['self_slider'], 'data-slider-orientation':'horizontal', 'data-slider-selection':'after', 'data-slider-tooltip':'hide'})}}100%</div><br>
                        </div>
                        </form>            
                    </div>
                </div>
            </div>
        </div>
    </div>   
</div>
{% if data %}
<div class="col-md-8" style="padding:0px;padding-right:20px;padding-left:20px;height:100%">
<!-- Output -->
    <div class="panel panel-primary"  style="margin:0px;height: 40%">
        <div class="panel-heading">
            <h3 class="panel-title">Recommended domains</h3>
        </div>
        <div class="panel-body" style="height:83%; overflow:auto;">
            <table class="table table-hover">
                <tr>
                  <th>Domain</th>
                  <th>Location</th>
                  <th>Edge weights</th>   
                  <th>Alexa rank</th>
                  <th>PageRank</th>
                  <th>In Degree</th>
                  <th>Out Degree</th>
                  <th>Self Degree</th>
                </tr>
                {%for line in data%}
                <tr>
                  <td>{{line[1]}}</td>
                  <td>{{line[3]}}</td>
                  <td>{{line[11]}}</td> 
                  <td>{{line[2]}}</td>
                  <td>{{line[10]}}</td>
                  <td>{{line[7]}}</td>
                  <td>{{line[6]}}</td>
                  <td>{{line[9]}}</td>
                </tr>
                {% endfor %}
            </table>         
        </div>
    </div>

    <div class="panel panel-warning"  style="margin:0px;padding:0px;height: 55%">
        <div class="panel-heading">
            <h3 class="panel-title">Releated Subgraph</h3>
        </div>
        <div class="panel-body" style="margin:0px;height:100%">        
		    <div id="graph-container" style="width:100%;height: 93%"></div>
        </div>
    </div>
{% endif %}
</div>
</div>
{% endblock %}

{% block scripts %}


<script src="{{ url_for('static', filename='js/bootstrap-slider.js') }}"></script>
<script src="{{ url_for('static', filename='js/sigma_new/src/sigma.core.js') }}"></script>
<script src="{{ url_for('static', filename='js/sigma_new/src/conrad.js') }}"></script>
<script src="{{ url_for('static', filename='js/sigma_new/src/utils/sigma.utils.js') }}"></script>
<script src="{{ url_for('static', filename='js/sigma_new/src/utils/sigma.polyfills.js') }}"></script>
<script src="{{ url_for('static', filename='js/sigma_new/src/sigma.settings.js') }}"></script>
<script src="{{ url_for('static', filename='js/sigma_new/src/classes/sigma.classes.dispatcher.js') }}"></script>
<script src="{{ url_for('static', filename='js/sigma_new/src/classes/sigma.classes.configurable.js') }}"></script>
<script src="{{ url_for('static', filename='js/sigma_new/src/classes/sigma.classes.graph.js') }}"></script>
<script src="{{ url_for('static', filename='js/sigma_new/src/classes/sigma.classes.camera.js') }}"></script>
<script src="{{ url_for('static', filename='js/sigma_new/src/classes/sigma.classes.quad.js') }}"></script>
<script src="{{ url_for('static', filename='js/sigma_new/src/captors/sigma.captors.mouse.js') }}"></script>
<script src="{{ url_for('static', filename='js/sigma_new/src/captors/sigma.captors.touch.js') }}"></script>
<script src="{{ url_for('static', filename='js/sigma_new/src/renderers/sigma.renderers.canvas.js') }}"></script>
<script src="{{ url_for('static', filename='js/sigma_new/src/renderers/sigma.renderers.webgl.js') }}"></script>
<script src="{{ url_for('static', filename='js/sigma_new/src/renderers/sigma.renderers.def.js') }}"></script>
<script src="{{ url_for('static', filename='js/sigma_new/src/renderers/webgl/sigma.webgl.nodes.def.js') }}"></script>
<script src="{{ url_for('static', filename='js/sigma_new/src/renderers/webgl/sigma.webgl.nodes.fast.js') }}"></script>
<script src="{{ url_for('static', filename='js/sigma_new/src/renderers/webgl/sigma.webgl.edges.def.js') }}"></script>
<script src="{{ url_for('static', filename='js/sigma_new/src/renderers/webgl/sigma.webgl.edges.fast.js') }}"></script>
<script src="{{ url_for('static', filename='js/sigma_new/src/renderers/webgl/sigma.webgl.edges.arrow.js') }}"></script>
<script src="{{ url_for('static', filename='js/sigma_new/src/renderers/canvas/sigma.canvas.labels.def.js') }}"></script>
<script src="{{ url_for('static', filename='js/sigma_new/src/renderers/canvas/sigma.canvas.hovers.def.js') }}"></script>
<script src="{{ url_for('static', filename='js/sigma_new/src/renderers/canvas/sigma.canvas.nodes.def.js') }}"></script>
<script src="{{ url_for('static', filename='js/sigma_new/src/renderers/canvas/sigma.canvas.edges.def.js') }}"></script>
<script src="{{ url_for('static', filename='js/sigma_new/src/renderers/canvas/sigma.canvas.edges.curve.js') }}"></script>
<script src="{{ url_for('static', filename='js/sigma_new/src/renderers/canvas/sigma.canvas.edges.arrow.js') }}"></script>
<script src="{{ url_for('static', filename='js/sigma_new/src/renderers/canvas/sigma.canvas.edges.curvedArrow.js') }}"></script>
<script src="{{ url_for('static', filename='js/sigma_new/src/middlewares/sigma.middlewares.rescale.js') }}"></script>
<script src="{{ url_for('static', filename='js/sigma_new/src/middlewares/sigma.middlewares.copy.js') }}"></script>
<script src="{{ url_for('static', filename='js/sigma_new/src/misc/sigma.misc.animation.js') }}"></script>
<script src="{{ url_for('static', filename='js/sigma_new/src/misc/sigma.misc.bindEvents.js') }}"></script>
<script src="{{ url_for('static', filename='js/sigma_new/src/misc/sigma.misc.drawHovers.js') }}"></script>
<script src="{{ url_for('static', filename='js/sigma_new/plugins/sigma.layout.forceAtlas2/worker.js') }}"></script>
<script src="{{ url_for('static', filename='js/sigma_new/plugins/sigma.layout.forceAtlas2/supervisor.js') }}"></script>
<!-- END SIGMA IMPORTS -->
<script src="{{ url_for('static', filename='js/sigma_new/plugins/sigma.parsers.json/sigma.parsers.json.js') }}"></script>
<script>
// sliders
$('#links_slider').slider()
$('#alexa_slider').slider()
$('#p_rank_slider').slider()
$('#in_slider').slider()
$('#out_slider').slider()
$('#self_slider').slider()
$('#sliders').css('visibility','visible')
// typeahead
$('#add_pos_domain').typeahead({
    source: {{all_domains|tojson}}
});
$('#add_neg_domain').typeahead({
    source: {{all_domains|tojson}}
});
// Graph
 // these are just some preliminary settings
{% if graph %}

   var g = {{graph|tojson}};

   // Create new Sigma instance in graph-container div (use your div name here) 
   s = new sigma({
   graph: g,
   container: 'graph-container',
	settings: {
	    drawEdges: true
	  },
   renderer: {
    container: document.getElementById('graph-container'),
    type: 'canvas'
   },
   settings: {
    minNodeSize: 5,
    maxNodeSize: 20
    } 
   });
   // first you load a json with (important!) s parameter to refer to the sigma instance   
   
   // Refresh the display:
    s.refresh();

    // ForceAtlas Layout
    s.configForceAtlas2({edgeWeightInfluence: 0.5, gravity:0.1,adjustSized: true, slowDown: 10})
    s.startForceAtlas2();
	// run for max 2 sec
	//setTimeout(function() { s.stopForceAtlas2(); }, 2000);


{% endif %}   
</script>
   
{% endblock %}
